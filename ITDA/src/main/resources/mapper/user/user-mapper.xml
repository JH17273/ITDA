<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
 
<mapper namespace="user">	
	<select id="selectNextUserNo" resultType="int">
		SELECT SEQ_UNO.NEXTVAL FROM DUAL
	</select>
	
	<insert id="insertUser">
		INSERT INTO USER_TB (
			USER_NUM,
			USER_ID,
			USER_PWD,
			NICKNAME,
			EMAIL,
			PHONE,
			BIRTH,
			ADDRESS,
			CREATE_DATE,
			USER_INF_VALIDITY_PERIOD,
			IS_QUIT
		) VALUES (
			SEQ_UNO.NEXTVAL,
			#{userId},
			#{userPwd},
			#{nickName},
			#{email},
			#{phone},
			#{birth},
			#{address},
			DEFAULT,
			DEFAULT,
			DEFAULT
		)
	</insert>
	
	<insert id="insertProfile" parameterType="com.kh.itda.user.model.vo.User">
		INSERT INTO PROFILE (USER_NO, IMAGE_URL)
		VALUES (#{userNo}, #{imageUrl})
	</insert>
	
	<insert id="insertAuthority">
		INSERT INTO AUTHORITIY (USER_NUM, AUTHORITY) VALUES (#{userNum}, 'ROLE_USER')
	</insert>
	
	<update id="updateUser">
		UPDATE USER_TB
			<set>
				<if test="email != null">
					EMAIL = #{email},
				</if>
				<if test="birth != null">
					BIRTH = #{birth},
				</if>
				<if test="nickName != null">
					NICKNAME = #{nickName},
				</if>
				<if test="phone != null">
					PHONE = #{phone},
				</if>
				<if test="address != null">
					ADDRESS = #{address},
				</if>
				<if test="userPwd != null and userPwd != ''">
					USER_PWD = #{userPwd},
				</if>
            CREATE_DATE = SYSDATE
			</set>
		WHERE USER_ID = #{userId}
	</update>
	
	<select id="idCheck" resultType="int">
		SELECT COUNT(*)
		FROM USER_TB
		WHERE USER_ID = #{userId}
	</select>
	
	<select id="selectOne" resultType="hashmap">
		SELECT 
			USER_ID,
			NICKNAME
		FROM USER_TB
		WHERE USER_ID = #{userId}
	</select>

</mapper>