<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="openchat">

    <!-- 오픈 채팅방 목록 조회 -->
    <select id="selectOpenChatRoomList" resultType="com.kh.itda.openchat.model.vo.OpenChatRoom">
        SELECT
            r.CHATROOM_ID AS chatRoomID,
            r.OPEN_CHAT_ROOM_NAME AS chatName,
            COUNT(DISTINCT m.USER_NUM) AS chatCount,
            r.MAX_CHATROOM_COUNT AS maxchatCount,
            r.DESCRIPTION AS description,
            LISTAGG(t.TAG_CONTENT, ',') WITHIN GROUP (ORDER BY t.TAG_CONTENT) AS tagContent
        FROM
            OPEN_CHAT r
        LEFT JOIN
            CHAT_PARTICIPANT m ON r.CHATROOM_ID = m.CHATROOM_ID
        LEFT JOIN
            OPENCHATROOM_TAG ot ON r.CHATROOM_ID = ot.CHATROOM_ID
        LEFT JOIN
            TAG t ON ot.TAG_ID = t.TAG_ID
        GROUP BY
            r.CHATROOM_ID, r.OPEN_CHAT_ROOM_NAME, r.MAX_CHATROOM_COUNT, r.DESCRIPTION
        ORDER BY
            r.CHATROOM_ID
    </select>
	
   
   <insert id="createOpenChat">
   	INSERT INTO OPEN_CHAT VALUES
   	(OPEN_CHAT_SEQ.NEXTVAL, #{})
   	
   </insert>
   
   

</mapper>
